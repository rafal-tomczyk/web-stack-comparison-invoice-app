<div class="flex items-center justify-between mb-4">
  <h2 class="text-3xl font-bold">Faktury</h2>
  <button 
    hx-get="{% url 'htmx_list' 'invoices' %}"
    hx-target="#spa-content"
    class="btn btn-error btn-md shadow-md">
    Wróć do listy faktur
  </button>
</div>

<div class="card bg-base-100 shadow-lg border border-base-300 rounded-box p-6">
  <h2 class="text-2xl font-bold mb-4">Dodaj nową fakturę</h2>
  
  <!-- ZMIANA: hx-target="#spa-content" zamiast #spa-view -->
  <form method="POST" hx-post="{% url 'htmx_invoice_add' %}" hx-target="#spa-content">
    {% csrf_token %}
    {{ form.as_table }}

    {{ item_formset.management_form }}

    {% if item_formset.non_form_errors %}
      <div class="alert alert-error my-2">
        {{ item_formset.non_form_errors }}
      </div>
    {% endif %}

    <table class="table w-full">
      <thead>
        <tr>
          <th>Produkt</th>
          <th>Ilość</th>
          <th>Cena netto</th>
          <th>VAT</th>
          <th>Usuń</th>
        </tr>
      </thead>
      <tbody id="items-table">
        {% for form in item_formset %}
          {% include "htmx_templates/partials/create/invoice_item_row_htmx.html" %}
        {% endfor %}
      </tbody>
    </table>
    
    <div class="mt-4 flex gap-4">
      <button
        type="button"
        hx-get="{% url 'htmx_invoice_add_item' %}"
        hx-target="#items-table"
        hx-swap="beforeend"
        hx-vals="js:{total_forms: document.getElementById('id_items-TOTAL_FORMS').value}"
        hx-on:htmx:after-request="
          let totalForms = document.getElementById('id_items-TOTAL_FORMS');
          totalForms.value = parseInt(totalForms.value) + 1;
        "
        class="btn btn-outline btn-primary">
        Dodaj pozycję
      </button>
      
      <button type="submit" class="btn btn-primary">
        Zapisz fakturę
      </button>
    </div>
  </form>
</div>
